define(["lib/zepto"],function($){var databox={initTabs:function(selector,opts){var $selector;if(typeof opts==="undefined")opts={};opts=$.extend({event:"mouseover",activeClass:"tab-active",disabledClass:"tab-disable",onOpen:function(){}},opts);selector=selector||"";$selector=$("ul.tabs");$selector.each(function(){var $tabDefault,$contents,$tabs=$(this);if($tabs.data("tabs-activated")||$tabs.hasClass("tabs-behavior"))return;$contents=$tabs.next(".tabs-content");$tabs.data("tabs-activated",true);if($tabs.data("tabs-event"))opts.event=
$tabs.data("tabs-event");if(opts.event==="mouseover")$tabs.find("li:not(.tab-behavior)").on("click",function(){return false});$tabs.find("li:not(.tab-behavior)").on(opts.event,function(){var $this=$(this),index=$this.index();if(!$this.hasClass(opts.disabledClass))databox.update(index,opts,$tabs,$contents);if($tabs.parents("#main-nav").length===0)return false;return true});$tabDefault=$tabs.find("."+opts.activeClass);$tabDefault.trigger(opts.event)})},update:function(index,opts,$tabs,$contents){var $select,
$html,path;$select=$contents.children("div").eq(index);$html=$select.html();if($html!==""){databox.updateTabs(index,opts,$tabs,$contents);$select.css({display:"block"});$(".loading").removeClass("loading");opts.onOpen.apply($select)}else{path=$("li:eq("+index+") a",$tabs).attr("href");if(path!==""){databox.updateTabs(index,opts,$tabs,$contents);var req=$.ajax({url:path});req.success(function(msg){$select=$contents.find("> div:eq("+index+")");$select.append(msg).css({display:"block"});$(".loading").removeClass("loading");
opts.onOpen.apply($select)}).error(function(){$select.empty().append("<p>Page introuvable</p>").css({display:"block"});$(".loading").removeClass("loading")})}else $select.empty().append("<p>Pas de chemin</p>").css({display:"block"})}},updateTabs:function(index,opts,$tabs,$contents){$("li",$tabs).removeClass(opts.activeClass);$contents.children("div").css({display:"none"});$tabs.find("li").eq(index).addClass(opts.activeClass);$contents.addClass("loading")}};return databox});
