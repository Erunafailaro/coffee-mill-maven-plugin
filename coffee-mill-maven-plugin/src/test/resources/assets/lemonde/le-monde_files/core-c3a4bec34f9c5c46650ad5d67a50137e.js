/**
 * Package www/core
 * lmd/core/auth
 * lmd/core/storage
 * lmd/core/service
 * lmd/core/conf
 * lmd/core/context
 * lmd/core/live
 * lmd/core/social/facebook
 * lmd/core/social/twitter
 * lmd/core/advert/ad-iframe
 * lmd/core/advert/delayed
 * lmd/core/advert/widget-position
 */

/* -- start module lmd/core/auth -- */
define("lmd/core/auth",["lib/jquery","lmd/core/storage","lib/jquery/plugin/jquery.cookie","lmd/core/service"],function($,storage,jqueryCookie,service){var auth={STORAGE_KEY:"user",COOKIE_USER_ID:"tdb_user_id",COOKIE_ALM:"alm",COOKIE_WORDPRESS:"wordpress_domain",user:null,_loadUserDeferred:null,_loadUserServicesDeferred:null,authenticated:false,checkAuthentication:function(){this.authenticated=$.cookie(this.COOKIE_USER_ID)!==null;if(this.authenticated===false)this.clearCache();return this.authenticated},refresh:function(){this.loadUser(true)},
update:function(){this._putInCache()},login:function(params,jsonp){var settings={};if(typeof jsonp==="boolean")settings={dataType:"jsonp"};return service.get("auth/login",1,params,settings)},logout:function(){this.clearCache();return service.get("auth/logout",1,null,{dataType:"jsonp"}).done($.proxy(this.clearCache,this))},loadUser:function(refresh){var firstLoad=false;if(this._loadUserDeferred===null||refresh){this._loadUserDeferred=$.Deferred();firstLoad=true}if(this._loadUserServicesDeferred===
null||refresh)this._loadUserServicesDeferred=$.Deferred();this.checkAuthentication();if(this.authenticated&&(firstLoad||refresh)){if(storage.isSupported&&!refresh){var user=storage.get(this.STORAGE_KEY);if(user!==null){var userId=this._getUserIdAlm();if(user.id==userId||userId===null){this.user=user;this._loadUserDeferred.resolve();if(!$.cookie(this.COOKIE_WORDPRESS)&&auth.user.services.indexOf("blog"))this.majServices(true);else this._loadUserServicesDeferred.resolve();return this._loadUserDeferred.promise()}}}var xhr=
service.get("auth/user",1,null,{dataType:"jsonp"}).done($.proxy(this._loadUserCallback,this));var xhr=service.get("auth/majServices",1,null,{dataType:"jsonp"}).done($.proxy(this._loadUserServicesCallback,this))}if(!this.authenticated){this._loadUserDeferred.resolve();this._loadUserServicesDeferred.resolve()}return this._loadUserDeferred.promise()},majServices:function(refresh){if(refresh)var xhr=service.get("auth/majServices",1,null,{dataType:"jsonp"}).done($.proxy(this._loadUserServicesCallback,
this));else{var closure=this;this.loadUser(refresh);return this._loadUserServicesDeferred.promise()}},clearCache:function(){storage.remove(this.STORAGE_KEY)},_getUserIdAlm:function(){var cookieAlm=$.cookie(this.COOKIE_ALM);if(cookieAlm===null)return null;var tab=cookieAlm.split("-");if(tab.length>2)return parseInt(tab[tab.length-2]);else return null},_loadUserCallback:function(data){if(typeof data==="object"&&typeof data.user==="object"){this.user=data.user;this._putInCache();this._loadUserDeferred.resolve()}else this._loadUserDeferred.reject()},
_loadUserServicesCallback:function(data){if(typeof data==="object"&&data.succes)this._loadUserServicesDeferred.resolve();else this._loadUserServicesDeferred.reject()},_putInCache:function(){if(storage.isSupported)storage.set(this.STORAGE_KEY,this.user,18E5,false)}};auth.authenticated=auth.checkAuthentication();return auth});

/* -- end module lmd/core/auth -- */
/* -- start module lmd/core/storage -- */
define("lmd/core/storage",["lib/jquery","lmd/core/conf","lib/jquery/plugin/jquery.cookie"],function($,conf,jqueryCookie){$.cookie=jqueryCookie;var storage={isSupported:false,get:function(key,session){var stockData,storageValue;if(this.isSupported)try{storageValue=window.localStorage.getItem(key);if(storageValue===null||session===true)storageValue=window.sessionStorage.getItem(key);stockData=JSON.parse(storageValue)}catch(e){return null}else stockData=JSON.parse(this._getNoStorage(key));if(!stockData)return null;if(stockData.timeout!==
undefined){var now=(new Date).getTime(),diff=parseInt(stockData.timeout,10)-now;if(diff<0){this.remove(key);return null}}if(stockData.data===undefined)return null;return stockData.data},set:function(key,data,timeout,session){var stockData={};stockData.data=data;if(typeof timeout!=="undefined"&&$.isNumeric(timeout))stockData.timeout=(new Date).getTime()+timeout;var stockDataJson=JSON.stringify(stockData);if(this.isSupported){try{if(typeof timeout!=="undefined"&&session===true)window.sessionStorage.setItem(key,
stockDataJson);else window.localStorage.setItem(key,stockDataJson)}catch(e){return false}return true}return this._setNoStorage(key,stockDataJson,timeout)},remove:function(key,session){if(this.isSupported){if(session){window.sessionStorage.removeItem(key);return true}window.sessionStorage.removeItem(key);window.localStorage.removeItem(key);return true}return this._removeNoStorage(key)},_setNoStorage:function(key,data,timeout){if($.cookie===undefined)return false;var options={path:"/",domain:"."+conf.current.location.domain};
if(typeof timeout==="number"){var expire=Math.floor(timeout/36E5);if(expire>0)options.expires=Math.floor(timeout/36E5)}$.cookie("storage_"+key,data,options);return true},_getNoStorage:function(key){if(typeof $.cookie==="undefined")return false;return $.cookie("storage_"+key)},_removeNoStorage:function(key){if(typeof $.cookie==="undefined")return false;$.cookie("storage_"+key,null);return true}};storage.isSupported=function(){try{return window.sessionStorage!==null&&window.localStorage!==null}catch(e){return false}}();
return storage});

/* -- end module lmd/core/storage -- */
/* -- start module lmd/core/service -- */
define("lmd/core/service",["lib/jquery","lmd/core/conf"],function($,conf){return{get:function(service,version,data,settings){if(typeof settings==="undefined")settings={};if(typeof settings.timeout==="undefined")settings.timeout=5E3;if(typeof settings.dataType==="undefined")settings.dataType="json";var jsonp=typeof settings.dataType==="string"&&settings.dataType==="jsonp";service.replace(/^\/?(.*)\/?$/,"$1");var url="/ws/"+version+"/"+service+"/";if(jsonp===true)url="http://"+conf.www.location.hostname+url;settings.data=
data;settings.url=url;if(jsonp===true){var defer=$.Deferred();$.ajax(settings).then(function(data){if(typeof data!=="object"||typeof data.error==="object")defer.reject(data);else defer.resolve(data)},defer.reject);return defer}return $.ajax(settings)}}});

/* -- end module lmd/core/service -- */
/* -- start module lmd/core/conf -- */
define("lmd/core/conf",function(){if(typeof lmd==="undefined"||typeof lmd.conf==="undefined")return null;lmd.conf.current=window.location.hostname.match(/abonnes/)?lmd.conf.abonnes:lmd.conf.www;var f=function(o){var i;if(typeof o.hostname!=="undefined"){o.domain=o.hostname.match(/[\-\w]*\.fr/);o.domain=o.hostname.match(/[\-\w]*\.fr/)!==null?o.domain[0]:""}for(i in o)if(typeof o[i]==="object")f(o[i])};f(lmd.conf);lmd.conf.search_hash="2139JDJ12J3";lmd.conf.url_deconnexion="http://"+lmd.conf.www.location.hostname+
"/deconnexion/";lmd.conf.placeholder_avatar="http://"+lmd.conf.medias.location.hostname+"/medias/web/img/placeholder/avatar.svg";return lmd.conf});

/* -- end module lmd/core/conf -- */
/* -- start module lmd/core/context -- */
define("lmd/core/context",["lmd/core/conf"],function(conf){var context={PAGE_TYPE_UNE:"Rubrique_Une",PAGE_TYPE_RUBRIQUE:"Rubrique",PAGE_TYPE_RUBRIQUE_TYPEITEM:"Rubrique_TypeItem",PAGE_TYPE_RUBRIQUE_BLOGS:"Rubrique_Blogs",PAGE_TYPE_ELEMENT:"Element",PAGE_TYPE_ANNALES_BAC:"Element",PAGE_TYPE_OTHER:"Autre",pageType:null,rubrique:null,item:null,element:null,page:null,init:function(){if(typeof window.lmd==="undefined"||typeof window.lmd.context==="undefined")return false;var contextData=window.lmd.context;this.pageType=
contextData.pageType;this.rubrique=contextData.rubrique;this.item=contextData.item;this.element=contextData.element;this.page=contextData.page;this._initCurrentPage()},_initCurrentPage:function(){this.page.link=window.location.pathname}};context.init();return context});

/* -- end module lmd/core/context -- */
/* -- start module lmd/core/live -- */
define("lmd/core/live",["lib/jquery","lmd/core/conf"],function($,conf){var intervalId=null,$el=$("<div></div>");var live={status:"stopped",interval:3,stop:function(){this.status="stopped";if(intervalId!==null){window.clearInterval(intervalId);intervalId=null}},start:function(interval){if(this.status==="started"&&(!interval||this.interval===interval))return;if(this.status==="started")this.stop();if(interval)this.interval=interval;intervalId=window.setInterval(this.pool,this.interval*1E3);this.status="started";this.pool()},
pool:function(){return $.ajax({url:"http://"+conf.live.location.hostname+"/mux.json",dataType:"script",cache:true})},success:function(events){this.trigger("success.start");events.forEach(function(event){this.trigger(event.type,event.data)},this);this.trigger("success.end")},on:function(event,callback,context){var f=context?$.proxy(callback,context):callback;$el.on(event,f);return this},trigger:function(event,extraParameters){$el.trigger(event,extraParameters);return this}};window.live=function(data){live.success(data)};
return live});

/* -- end module lmd/core/live -- */
/* -- start module lmd/core/social/facebook -- */
define("lmd/core/social/facebook",["lib/jquery","lmd/core/conf","lmd/core/context"],function($,conf,context){var facebook={_loadDeferred:null,parse:function(options){var iframe_hgt,$fb_likes=$(".article .fb-like");var hostname=conf.www.location.hostname;if(typeof options.use_current_location!=="undefined"&&options.use_current_location===true)hostname=window.location.hostname;$(".fb-like").each(function(){var href=$(this).data("href");if(typeof href==="undefined")$(this).attr("data-href","http://"+hostname+window.location.pathname)});
FB.XFBML.parse();FB.Event.subscribe("xfbml.render",function(){window.setTimeout(function(){$fb_likes.first().css("overflow","visible").animate({opacity:"1"},200)},300)});window.setTimeout(function(){iframe_hgt=$fb_likes.first().find("iframe").css("height");$fb_likes.first().animate({"height":iframe_hgt},200);$fb_likes.last().css("height",iframe_hgt)},2E3)},partage:function(selector,options){selector=selector||"";options=$.extend({link:false,redirect_uri:"http://"+conf.www.location.hostname+context.page.link,
xt:false,use_current_location:false},options);$(selector).click(function(event){var url=options.link;if(url===false){if(typeof $(this).attr("data-href")==="undefined"||$(this).attr("data-href")==="")return;url=$(this).attr("data-href")}var hostname=conf.www.location.hostname;if(options.use_current_location===true)hostname=window.location.hostname;if(url.substr(0,7)!=="http://")url="http://"+hostname+url;if(typeof xt_click!=="undefined"&&options.xt!==false)xt_click(event.target,"C",context.page.xiti.xtn2,
options.xt,"A");facebook.load().done(function(){FB.ui({method:"feed",link:url,redirect_uri:options.redirect_uri})})})},load:function(){if(this._loadDeferred===null||typeof window.FB!=="undefined")this._loadDeferred=$.Deferred();if(typeof window.FB!=="undefined")this._loadDeferred.resolve();else{var deffered=this._loadDeferred;window.fbAsyncInit=function(){FB.init({appId:"166878320861",status:true,cookie:true,xfbml:true});deffered.resolve()};$("body").append('<div id="fb-root"></div>');(function(d){var js,
id="facebook-jssdk",ref=d.getElementsByTagName("script")[0];if(d.getElementById(id))return;js=d.createElement("script");js.id=id;js.async=true;js.src="//connect.facebook.net/fr_FR/all.js";ref.parentNode.insertBefore(js,ref)})(document)}return this._loadDeferred.promise()}};return facebook});

/* -- end module lmd/core/social/facebook -- */
/* -- start module lmd/core/social/twitter -- */
define("lmd/core/social/twitter",["lib/jquery","lmd/core/conf","lmd/core/context","lmd/ui/popup"],function($,conf,context,popup){var twitter={_loadDeferred:null,_loadTwttrTextDeferred:null,partage:function(selector,options){selector=selector||"";options=$.extend({link:false,title:false,xt:false,xtor:false,use_popup:true,width:550,height:320,position:"center",use_current_location:false},options);$(selector).click(function(event){var url=options.link,title=options.title;if(url===false){if(typeof $(this).attr("data-href")===
"undefined"||$(this).attr("data-href")==="")return;url=$(this).attr("data-href")}if(title===false){if(typeof $(this).attr("data-title")==="undefined"||$(this).attr("data-title")==="")return;title=$(this).attr("data-title")}var hostname=conf.www.location.hostname;if(options.use_current_location===true)hostname=window.location.hostname;if(url.substr(0,7)!=="http://")url="http://"+hostname+url;if(typeof xt_click!=="undefined"&&options.xt!==false)xt_click(event.target,"C",context.page.xiti.xtn2,options.xt,
"A");url+="#xtor=AL-32280258";url="http://twitter.com/share?related=lemondefr&via=lemondefr&lang=fr&text="+encodeURI(title)+"&url="+encodeURI(url);if(options.use_popup===true)popup.openPopup({position:options.position,width:options.width,height:options.height,link:url});else window.location.href=url})},liste:function(id,username,liste,options){id=id||"";options=$.extend({version:2,rpp:30,interval:3E4,title:"",subject:"",width:"auto",height:300,theme:{shell:{background:"#fafbfc",color:"#16212C"},tweets:{background:"#fafbfc",
color:"#444444",links:"#129bf0"}},footer:"Rejoindre la conversation",features:{scrollbar:true,loop:false,live:true,behavior:"all"}},options);options.id=id;options.type="list";this.loadTwttrText().done(function(){(new TWTR.Widget(options)).render().setList(username,liste).start()})},load:function(){if(this._loadDeferred===null||$("body").data("twttr-rendered"))this._loadDeferred=$.Deferred();if($("body").data("twttr-rendered"))this._loadDeferred.resolve();else require(["twitter/widgets"],this._loadDeferred.resolve);
return this._loadDeferred.promise()},loadTwttrText:function(){if(this._loadTwttrTextDeferred===null){this._loadTwttrTextDeferred=$.Deferred();require(["twitter/twitter-text"],this._loadTwttrTextDeferred.resolve)}else this._loadTwttrTextDeferred.resolve();return this._loadTwttrTextDeferred.promise()}};return twitter});

/* -- end module lmd/core/social/twitter -- */
/* -- start module lmd/core/advert/ad-iframe -- */
define("lmd/core/advert/ad-iframe",["lib/jquery","lib/jquery/plugin/jquery.containsAd"],function($,jqueryContainsAd){$.fn.containsAd=jqueryContainsAd;var adIframe={};adIframe.createIframe=function(position,options){this.options={src:"/advert/iframe/"+position+".html",width:0,height:0,seamless:"seamless",allowtransparency:true,scrolling:"no",frameborder:0,classes:"advert_iframe advert_iframe_"+position};$.extend(this.options,options);this.$el=$("<iframe>");this.$el.attr("src",this.options.src);this.$el.attr("width",this.options.width);
this.$el.attr("height",this.options.height);this.$el.attr("seamless",this.options.seamless);this.$el.attr("allowtransparency",this.options.allowtransparency);this.$el.attr("scrolling",this.options.scrolling);this.$el.attr("frameborder",this.options.frameborder);this.$el.addClass(this.options.classes);this.$el.get(0).adIframe=this;this.$el.load(function(){if(!$(this).contents().find("#advert").containsAd()){$(this).trigger("no_advert_found");$(this).hide()}});this.$el.get(0).reload=function(){if(typeof this.contentDocument!==
"undefined")this.contentDocument.location.reload(true);else this.src=this.src};return this.$el.get(0)};return adIframe});

/* -- end module lmd/core/advert/ad-iframe -- */
/* -- start module lmd/core/advert/delayed -- */
define("lmd/core/advert/delayed",["lib/jquery","lib/jquery/plugin/jquery.containsAd"],function($,jqueryContainsAd){$.fn.containsAd=jqueryContainsAd;var advert={parsed:false,parse:function(selector){if(this.parsed)return;selector=selector||"body";$(selector).find(".position_pub").each(function(){var position=$(this),data,htmlPosition=this,html="",el;data=position.data();$(".advert-stock").each(function(){if(data.id==$(this).data().id){$(this).find("a img[width=1][height=1]").hide();el=$(this)}});if(el){htmlPosition.appendChild(el.get(0));
el.show()}});$('.position_pub[data-id!="Top"]').each(function(){if(!$(this).containsAd())$(this).hide();else{$(this).addClass("filled");var classname="position_pub_"+$(this).data("id");$("."+classname).show()}});$(".position_pub[data-id=Top1]").addClass("mgb16");this.parsed=true}};return advert});

/* -- end module lmd/core/advert/delayed -- */
/* -- start module lmd/core/advert/widget-position -- */
define("lmd/core/advert/widget-position",["lib/jquery","lmd/core/storage","lmd/core/context"],function($,storage,context){var rubriqueOmbrelleId="";if(typeof context.rubrique!=="undefined"&&context.rubrique&&typeof context.rubrique.rubrique_ombrelle!=="undefined"&&context.rubrique.rubrique_ombrelle&&typeof context.rubrique.rubrique_ombrelle.id!=="undefined"&&context.rubrique.rubrique_ombrelle.id)rubriqueOmbrelleId=context.rubrique.rubrique_ombrelle.id;var widgetContainer=$("#widget_container"),adPosition="Top3",widgetEditoDisplayKey=
"widget-edito-display";if(rubriqueOmbrelleId!=="")widgetEditoDisplayKey+=":"+rubriqueOmbrelleId;return{init:function(){var closure=this;if(this.canShowEditoWidget()){this.showWidget();this.increaseEditoWidgetDisplay()}else require(["lib/jquery","lmd/core/advert/ad-iframe"],function($,adIframe){var options={width:300,height:60};var iframe=adIframe.createIframe(adPosition,options);$(iframe).bind("no_advert_found",closure.showWidget);widgetContainer.append(iframe)})},showWidget:function(){require(["lib/jquery",
"lib/jquery/plugin/jquery.ajah"],function($){widgetContainer.ajah({url:widgetContainer.data("uri")})})},canShowEditoWidget:function(){if(storage.isSupported===false)return true;var display=storage.get(widgetEditoDisplayKey,true);return!display||display==0},increaseEditoWidgetDisplay:function(){if(storage.isSupported===false)return;var display=storage.get(widgetEditoDisplayKey,true);if(!display)display=0;storage.set(widgetEditoDisplayKey,display+1,null,true)}}});

/* -- end module lmd/core/advert/widget-position -- */