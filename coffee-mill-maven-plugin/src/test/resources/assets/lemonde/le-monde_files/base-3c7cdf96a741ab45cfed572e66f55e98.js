/**
 * Package www/base
 * lmd/util/link
 * lmd/ui/plier-deplier
 * lmd/ui/header/header
 * lmd/ui/liste-az
 * lmd/ui/popup
 * lmd/ui/resize-column
 * lmd/ui/meteo/search-form
 * lmd/ui/slideshow
 * lmd/ui/auth/login
 * lmd/ui/image/lazy-retina
 * lmd/ui/component
 * lmd/ui/lightbox
 * lmd/module/user/meteo
 * lmd/module/retina
 * lmd/module/alerte
 * lmd/module/encontinu
 * lmd/module/lives
 * lmd/module/live
 * lmd/module/partenaire/monster_form
 */

/* -- start module lmd/util/link -- */
define("lmd/util/link",function(require){var $=require("lib/jquery");var link={parse:function(selector,callback){selector=selector||"body";var timeoutOver,e;$(selector).find(".lien_interne").hover(function(event){e=event;timeoutOver=window.setTimeout(function(){$(e.currentTarget).css("text-decoration","underline");$(e.currentTarget).css("cursor","pointer")},500)},function(event){window.clearTimeout(timeoutOver);$(e.currentTarget).css("text-decoration","none");$(e.currentTarget).css("cursor","text")});
$(selector).find(".lien_interne").click(function(e){window.open(e.target.href)});$(function(){(function(o){var anchor,s,attrs,p,i,j,k,l;for(i=0,j=o.length;i<j;i=i+1){anchor=document.createElement("a");s=o[i];attrs=s.attributes;p=s.parentNode;for(k=0,l=attrs.length;k<l;k=k+1){if(attrs[k].name.match(/data-[href|target]/))if(attrs[k].name.match(/href/))anchor.setAttribute(attrs[k].name.slice(5),window.atob(attrs[k].value));else anchor.setAttribute(attrs[k].name.slice(5),attrs[k].value);else anchor.setAttribute(attrs[k].name,
attrs[k].value);anchor.innerHTML=s.innerHTML}p.insertBefore(anchor,s);p.removeChild(s)}})($(selector).find(".obf").get());if(callback)callback()})}};return link});

/* -- end module lmd/util/link -- */
/* -- start module lmd/ui/plier-deplier -- */
define("lmd/ui/plier-deplier",function(require){var $=require("lib/jquery");return{parse:function(selector){selector=selector||"body";$(selector).find(".voir_plus").each(function(){var $b,$p,$img,$img_ico,$repliable,$deplier;$b=$(this);$p=$b.find("p");$img=$b.find("img");$img_ico=$img.parents().first(".img_ico");$repliable=$b.find(".repliable").first().hide();$deplier=$b.find(".deplier").first();$b.on("mouseenter mouseleave",function(){$b.find(".deplier").first().toggleClass("visible")});$p.on("mouseenter mouseleave",
function(){$b.toggleClass("hovered")});if($img_ico.length)$img_ico.on("mouseenter mouseleave",function(){$b.find("a").first().toggleClass("lien_focus")});else $img.on("mouseenter mouseleave",function(){$b.find("a").first().toggleClass("lien_focus")});$deplier.on("click",function(){$repliable.toggle();$deplier.toggleClass("ouvert ferme")});$p.on("click",function(){$repliable.toggle();$deplier.toggleClass("ouvert ferme")})})}}});

/* -- end module lmd/ui/plier-deplier -- */
/* -- start module lmd/ui/header/header -- */
define("lmd/ui/header/header",["lib/jquery","lmd/core/conf","lmd/core/auth","lib/jquery/plugin/jquery.spin","lmd/ui/auth/login"],function($,conf,auth,jquerySpin,login){return{exportMode:false,init:function(){this.initSearch();this.initSocial();this.initOffline();this.initUser()},initSocial:function(){$("#header_utilisateur .lien_social_header").on("mouseenter mouseleave",function(){var $this=$(this);$this.find(".conteneur_popinbox").stop(true,true).fadeToggle(200);if($this.hasClass("loaded")===false){if($this.hasClass("facebook")){$this.find("#header_facebook_contenu").addClass("fb-like-box").spin({width:290,
height:240});if(typeof FB!=="undefined")FB.XFBML.parse($this.get(0));else require(["lmd/core/social/facebook"],function(facebook){facebook.load().done(function(){FB.XFBML.parse($this.get(0));$this.find("#header_facebook_contenu").unspin()})})}else if($this.hasClass("twitter")){$this.find("#header_twitter_contenu").spin({width:290,height:110});require(["lmd/core/social/twitter"],function(twitter){twitter.load().done(function(){$this.find("#header_twitter_contenu").unspin()})})}$this.addClass("loaded")}})},
initSearch:function(){$("#header_utilisateur .recherche [name=token]").val(window.btoa(Math.round((new Date).getTime()/1E3)+conf.search_hash))},initOffline:function(){if(auth.authenticated===true)return;$("#ln_monde_academie").show();login.init();$(".trigger_boite_login").on("click",$.proxy(login.open,login))},initUser:function(){if(auth.authenticated===false)return;var k=this;require(["lmd/ui/header/user-header"],function(userHeader){userHeader.exportMode=k.exportMode;userHeader.init()})}}});

/* -- end module lmd/ui/header/header -- */
/* -- start module lmd/ui/liste-az -- */
define("lmd/ui/liste-az",["lib/jquery"],function($){return{init:function(){var $nav_ariane=$("#nav_ariane"),$az_ariane=$("#ariane_az .entrees"),$az_ariane_entree=$("#ariane_az .suite_entrees"),$ss_nav_Li="",ss_nav_li_list=[],ss_nav_a_list=[],sous_nav_width=0,sous_nav_width_2=0,sous_nav_total_width=$nav_ariane.width()-$(".az",$nav_ariane).outerWidth(true);$("li",$nav_ariane).each(function(index,value){sous_nav_width+=$(this).outerWidth(true);if(sous_nav_width>sous_nav_total_width)ss_nav_a_list.push($("a",this).get(0))});
if(ss_nav_a_list.length>0){$az_ariane.prepend(ss_nav_a_list);$("li",$nav_ariane).filter(function(index){return $(this).children().length<1}).remove()}if(sous_nav_total_width-sous_nav_width-sous_nav_width_2>0)$("a",$az_ariane).each(function(index,value){sous_nav_width_2+=$(this).outerWidth(true);if(sous_nav_total_width-sous_nav_width-sous_nav_width_2>0){$ss_nav_Li=$('<li class="sous_rub"></li>').append($(this));ss_nav_li_list.push($ss_nav_Li.get(0))}else return false});if(ss_nav_li_list.length>0)$("ul",
$nav_ariane).append(ss_nav_li_list);if($("a",$az_ariane).size()<=0)$(".az",$nav_ariane).css({position:"absolute"});else if($(".az",$nav_ariane).css({position:"absolute"}))$(".az",$nav_ariane).css({position:"static"});$(".az",$nav_ariane).on("click",function(){if($az_ariane_entree.css("position")==="absolute")$az_ariane_entree.css({position:"static"});else $az_ariane_entree.css({position:"absolute"})})}}});

/* -- end module lmd/ui/liste-az -- */
/* -- start module lmd/ui/popup -- */
define("lmd/ui/popup",function(require){var $=require("lib/jquery");var popup={parse:function(selector,options){selector=selector||"";options=$.extend({identifier:"popup",link:function(element){return $(element).attr("href")},position:{top:0,left:0},width:screen.width,height:screen.height},options);if(options.link!==false)$(selector).on("click",function(e){e.preventDefault();popup.openPopup({identifier:options.identifier,position:options.position,width:options.width,height:options.height,scrollbars:options.scrollbars,
link:options.link(this)})})},openPopup:function(options){var popupItem;options=$.extend({identifier:"popup",position:{top:0,left:0},width:screen.width,height:screen.height,scrollbars:"no",link:false},options);if(options.link===false)return;popupItem=window.open(options.link,options.identifier,"status=no,width="+options.width+",height="+options.height+",scrollbars="+options.scrollbars+",resizable=yes");if(options.position==="center")options.position={top:(screen.height-options.height)/2,left:(screen.width-
options.width)/2};popupItem.moveTo(options.position.left,options.position.top);popupItem.focus()}};return popup});

/* -- end module lmd/ui/popup -- */
/* -- start module lmd/ui/resize-column -- */
define("lmd/ui/resize-column",function(require){var $=require("lib/jquery");return{REFRESH_TICK:1E3,MIN_BLOCK_WIDTH:100,_timer:null,selector:null,init:function(selector){if(typeof selector!=="undefined")this.selector=selector;if(this._timer===null)this._timer=setInterval($.proxy(this.resize,this),this.REFRESH_TICK)},resize:function(){$(".col_droite>div").last().css("marginBottom",0);if(!$(".col_droite.resizable").length||!$(".col_gauche").length)return;var colDroiteHeight=$(".col_droite.resizable").height(),
colGaucheHeight=$(".col_gauche").height(),blockSelector,blockHeight,diff,finalBlockHeight;if(this.selector!==null)blockSelector=$(this.selector).first();else blockSelector=$(".plus_partages");if(typeof blockSelector==="undefined"||blockSelector===null)return;blockHeight=blockSelector.height();diff=colDroiteHeight-colGaucheHeight;finalBlockHeight=blockHeight-diff;if(Math.abs(diff)>3)if(finalBlockHeight<this.MIN_BLOCK_WIDTH)blockSelector.slideUp(400);else if(blockSelector.height()!==finalBlockHeight)blockSelector.animate({height:finalBlockHeight},
400,function(){blockSelector.height(finalBlockHeight)})}}});

/* -- end module lmd/ui/resize-column -- */
/* -- start module lmd/ui/meteo/search-form -- */
define("lmd/ui/meteo/search-form",["lib/jquery"],function($){var form={init:function(form){this.$form=$(form);this.$cityField=this.$form.find("[name=recherche_ville]");this.$form.submit($.proxy(this.onSubmit,this))},onSubmit:function(){var citySize=this.$cityField.val().length;if(citySize<2){if(citySize===0)this.$cityField.focus();return false}this.$cityField.val(this.$cityField.val().toUpperCase());return true}};return form});

/* -- end module lmd/ui/meteo/search-form -- */
/* -- start module lmd/ui/slideshow -- */
define("lmd/ui/slideshow",["lib/jquery","lib/jquery/plugin/jquery.lazyload"],function($,jqueryLazyload){var F=function(){var render,init,autoSlideTick,initAutoSlide,autoSlide,clearAutoSlide,updateNavigation,slideToPage,slideNext,slidePrev,bindLeftRight,unbindLeftRight;var crs=this;slidePrev=function(){slideToPage(crs.vals.currentPage-1)};slideNext=function(){slideToPage(crs.vals.currentPage+1)};slideToPage=function(page){var leftValue,i,j;unbindLeftRight();clearAutoSlide();if(page<=crs.vals.totalPage&&page>0){crs.vals.currentPage=
page;leftValue=-(crs.vals.blockWidth*crs.opts.numberDisplayBlock*(crs.vals.currentPage-1));crs.opts.$content.animate({left:leftValue},500,function(){bindLeftRight()});updateNavigation()}else if(crs.opts.infini&&page===crs.vals.totalPage+1){crs.vals.currentPage=1;leftValue=-(crs.vals.blockWidth*crs.opts.numberDisplayBlock*crs.vals.totalPage);if(crs.opts.infini&&!crs.vals.clonedLast)crs.vals.clonedLast=true;crs.opts.$content.animate({left:leftValue},500,function(){$(this).animate({left:0},0,function(){bindLeftRight()})});
updateNavigation()}else if(crs.opts.infini&&page===0){crs.vals.currentPage=crs.vals.totalPage;leftValue=0;crs.opts.$content.animate({left:crs.vals.blockWidth*crs.opts.numberDisplayBlock},500,function(){$(this).animate({left:-(crs.vals.blockWidth*crs.opts.numberDisplayBlock*(crs.vals.totalPage-1))},0,function(){bindLeftRight()})});updateNavigation()}else bindLeftRight()};updateNavigation=function(){if(crs.opts.$navPrev.length>=1&&crs.opts.$navNext.length>=1){crs.opts.$navPrev.removeClass("active");
crs.opts.$navNext.removeClass("active");if(crs.vals.currentPage<crs.vals.totalPage)crs.opts.$navNext.addClass("active");if(crs.vals.currentPage>1)crs.opts.$navPrev.addClass("active")}if(crs.opts.$navDotContainer!==null&&crs.opts.$navDotContainer.length)crs.opts.$navDots.removeClass("actif").eq(crs.vals.currentPage-1).addClass("actif");crs.opts.$content.find(".shown").first().removeClass("shown");crs.opts.$elts.eq(crs.vals.currentPage-1).addClass("shown")};autoSlide=function(time){if(crs.opts.autoSlideOn)crs.vals.autoSlideIntervalHandler.push(window.setTimeout(function(){autoSlideTick(time)},
time))};clearAutoSlide=function(){var i,j;if(crs.vals.autoSlideIntervalHandler)for(i=0,j=crs.vals.autoSlideIntervalHandler.length;i<j;i=i+1)window.clearTimeout(crs.vals.autoSlideIntervalHandler.shift())};autoSlideTick=function(time){if(!crs.opts.infini)if(crs.vals.currentPage===crs.vals.totalPage)crs.vals.autoSlideReverse=true;else if(crs.vals.currentPage===1)crs.vals.autoSlideReverse=false;if(crs.vals.autoSlideReverse)slidePrev();else slideNext();autoSlide(crs.opts.autoSlideInterval)};initAutoSlide=
function(time){if(typeof time==="undefined"||!time)time=15E3;crs.opts.$container.hover(function(){clearAutoSlide()},function(){autoSlide(time)});if(crs.opts.$nav.length>0)crs.opts.$nav.hover(function(){clearAutoSlide()},function(){autoSlide(time)});autoSlide(time)};bindLeftRight=function(){if(crs.opts.$navPrev.length>=1||crs.opts.$navNext.length>=1){unbindLeftRight();crs.opts.$navPrev.on("click",function(){slidePrev(crs)});crs.opts.$navNext.on("click",function(){slideNext(crs)})}};unbindLeftRight=
function(){if(crs.opts.$navPrev.length>=1||crs.opts.$navNext.length>=1){crs.opts.$navPrev.unbind("click");crs.opts.$navNext.unbind("click")}};render=function(){var totalBlock,contentHeight,contentWidth,wid,i,j;crs.vals.blockWidth=crs.opts.$content.children().outerWidth(true);totalBlock=crs.opts.$content.children().length;contentHeight=crs.opts.$content.children().outerHeight(true);contentWidth=crs.vals.blockWidth*totalBlock;crs.vals.totalPage=Math.ceil(totalBlock/crs.opts.numberDisplayBlock);crs.opts.$container.css({overflow:"hidden",
position:"relative"});crs.opts.$content.css({height:contentHeight,width:contentWidth+(crs.opts.decale||crs.opts.infini?crs.vals.blockWidth*4:0),position:"relative",top:0,left:0});if(crs.opts.decale){wid=-(crs.vals.blockWidth*2-Math.ceil((crs.opts.$container.width()-crs.vals.blockWidth)/2))+"px";crs.opts.$elts.each(function(){$(this).css("left",wid)});crs.vals.$firstClone=crs.opts.$elts.first().clone();crs.vals.$secondClone=crs.opts.$elts.eq(1).clone();crs.vals.$lastClone=crs.opts.$elts.last().find("img").lazyload({skip_invisible:false}).end().clone().find("img").lazyload({skip_invisible:false}).end();
crs.vals.$penultimateClone=crs.opts.$elts.eq(crs.opts.$elts.length-2).find("img").lazyload({skip_invisible:false}).end().clone().find("img").lazyload({skip_invisible:false}).end();crs.opts.$content.append(crs.vals.$firstClone).append(crs.vals.$secondClone);crs.opts.$content.prepend(crs.vals.$lastClone).prepend(crs.vals.$penultimateClone)}window.setTimeout(function(){$("img",crs.opts.$content).each(function(){$(this).lazyload({container:crs.opts.$content})})},crs.opts.autoSlideInterval);crs.opts.$elts.first().addClass("shown");
if(crs.opts.infini){crs.vals.$extraAppended=crs.opts.decale?crs.vals.$lastClone:false;crs.vals.$extraPrepended=crs.opts.decale?crs.vals.$firstClone:false}if(crs.opts.$navDotContainer!==null&&crs.opts.$navDotContainer.length>=1)crs.opts.$navDotContainer.on("click",crs.opts.$navDots,function(event){var index=$(event.target).index();slideToPage(index+1)});bindLeftRight();if(crs.opts.autoSlideOn)initAutoSlide(crs.opts.autoSlideInterval)};(function(){F.prototype.opts={};F.prototype.vals={};F.prototype.init=
function(opts){this.vals={currentPage:1,autoSlideIntervalHandler:[]};this.opts=opts;this.opts.$container=$(this.opts.$container);this.opts.$content=$(this.opts.$content,this.opts.$container).first();this.opts.$elts=$(".elt",this.opts.$content);this.opts.$nav=$(this.opts.$nav);this.opts.$navPrev=$(this.opts.$navPrev,this.opts.$nav);this.opts.$navNext=$(this.opts.$navNext,this.opts.$nav);if(this.opts.$navDots){this.opts.$navDotContainer=$(this.opts.$navDotContainer);this.opts.$navDots=$(this.opts.$navDots,
this.opts.$navDotContainer)}if(this.opts.$container.length<=0||this.opts.$content.length<=0)return false;render(this)}})()};return function(){return new F}});

/* -- end module lmd/ui/slideshow -- */
/* -- start module lmd/ui/auth/login -- */
define("lmd/ui/auth/login",["lib/jquery","lib/jquery/plugin/jquery.spin","lib/hogan/core/hogan","lmd/core/conf","lmd/core/auth","lmd/ui/lightbox","template!/templates/module/user/login.html.mu"],function($,jquerySpin,hogan,conf,auth,lightbox,template){return{initialized:false,init:function(){if(this.initialized===true)return;var compiledTemplate=hogan.compile(template),k=this;this.$box=$(compiledTemplate.render({conf:conf}));this.initialized=true},open:function(options){var k=this;this.init();if(this.$box.is(":visible"))return;
lightbox.open(this.$box,{width:770,height:288});this.$box.find("input").on("change",function(){$(this).removeClass("saisie_erreur")});this.$box.find(".trigger_password_recover").on("click",function(){k.showRecoverPasswordForm();return false});this.$box.find(".form_back").on("click",function(){k.showMainForm();return false});this.$box.find("#login_form").on("submit",$.proxy(this.onSubmitMainForm,this));this.$box.find("#rmdp_form_form").on("submit",$.proxy(this.onSubmitRecoverPasswordForm,this));this.$box.find("#loginbox_email").focus();
if(typeof options!=="undefined"&&typeof options.loginSuccessCallback==="function")this.loginSuccessCallback=options.loginSuccessCallback},setRedirectUrl:function(url){this.init();this.$box.find("[name=url]").val(url)},setRedirectUrlAbonne:function(url){this.init();this.$box.find("[name=url_zop]").val(url)},close:function(){lightbox.close()},showRecoverPasswordForm:function(){this.$box.find("#fenetre_1").hide();this.$box.find("#password_recover_box").show()},showMainForm:function(){this.$box.find("#password_recover_box").hide();
this.$box.find("#fenetre_1").show()},showErrorMainForm:function(type,message){this.$box.find(".txt_erreur").hide();if(type==="not-filled")this.$box.find(".login_error_not_filled").css("display","block");else if(type==="auth")this.$box.find(".login_error_auth").css("display","block")},onSubmitMainForm:function(event){var $form=this.$box.find("#login_form"),$email=$form.find("[name=mail]"),$password=$form.find("[name=passe]"),$keepConnection=$form.find("[name=sauv_login]");if($password.val().length>
3&&$email.val().length>0){this.$box.find("#login_form").spin();auth.login({login:$email.val(),password:$password.val(),remember:$keepConnection.is(":checked")},true).then($.proxy(this.loginSuccess,this),$.proxy(this.loginFail,this))}else{$email.addClass("saisie_erreur");$password.addClass("saisie_erreur");this.showErrorMainForm("not-filled")}return false},loginSuccess:function(data){if(typeof this.loginSuccessCallback==="function")this.loginSuccessCallback.call(this,data);var k=this;auth.loadUser(true).done(function(){var urlName=
"url",abonne=false;if(auth.user&&typeof auth.user.abonne==="boolean"&&auth.user.abonne===true){urlName="url_zop";abonne=auth.user.abonne}var redirectUrl=k.$box.find("[name="+urlName+"]").val(),urlPattern=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;if(redirectUrl.match(urlPattern)===null){redirectUrl=window.location.href;if(abonne===true&&redirectUrl.match(/www\.lemonde/)!==null)redirectUrl=redirectUrl.replace(/www\.lemonde/,"abonnes.lemonde")}k.$box.find(".erreur").hide();
k.$box.find("#login_form").unspin();lightbox.close();if(window.location.href===redirectUrl)window.location.reload();else window.location.href=redirectUrl})},loginFail:function(data){this.showErrorMainForm("auth");this.$box.find("#login_form").unspin()},onSubmitRecoverPasswordForm:function(event){var recoverPasswordUrl="http://"+conf.www.location.hostname+"/api/1/user/retrouver_mdp/",$form=this.$box.find("#rmdp_form_form"),$email=$form.find("[name=email]");if($email.val().length===0){$email.addClass("saisie_erreur");
return false}var data="params="+JSON.stringify({mode:"retrouver",email:$email.val()});$form.find("[type=submit]").attr("disabled","disabled");$.ajax({url:recoverPasswordUrl,type:"get",dataType:"jsonp",data:data}).then($.proxy(this.recoverPasswordSuccess,this),$.proxy(this.recoverPasswordFail,this));return false},recoverPasswordSuccess:function(data){if(typeof data==="object"&&typeof data.exception!=="undefined")return this.recoverPasswordFail(data);this.$box.find("#rmdp_ro_email").html(this.$box.find("#password_recover_box [name=password_recover_box_email]").val());
this.$box.find("#password_recover_box .rmdp_confirm").show();this.$box.find("#password_recover_box [type=submit]").removeAttr("disabled")},recoverPasswordFail:function(data){this.$box.find("#password_recover_box .alerte").show();this.$box.find("#password_recover_box [type=submit]").removeAttr("disabled")}}});

/* -- end module lmd/ui/auth/login -- */
/* -- start module lmd/ui/image/lazy-retina -- */
define("lmd/ui/image/lazy-retina",function(){if(!window["lzld"])(function(window,document){var winH=viewport(),imgs=[],pageHasLoaded=false,unsubscribed=false,saveViewportT=throttle(viewport,20),showImagesT=throttle(showImages,20);window["lzld"]=onDataSrcImgLoad;window["lzld"]["config"]={retina:"auto",hdCallback:defaultHdCallback,lazyAttr:"data-src",minDevicePixelRatio:1.5,offset:200};window["lzld"]["update"]=update;dataNoHDAttr="data-no-hd-src",dataHDAttr="data-hd-src";function isRetinaDevice(){var pixelRatio=typeof window.devicePixelRatio!==
"undefined"?window.devicePixelRatio:1;return pixelRatio>=window.lzld.config.minDevicePixelRatio}window["lzld"]["isRetinaDevice"]=isRetinaDevice;domready(findImages);addEvent(window,"load",onLoad);subscribe();function onDataSrcImgLoad(img){if(inArray(img,imgs)===-1){if(unsubscribed)subscribe();showIfVisible(img,imgs.push(img)-1)}}function findImages(){var domreadyImgs=document.getElementsByTagName("img"),currentImg;for(var imgIndex=0,max=domreadyImgs.length;imgIndex<max;imgIndex+=1){currentImg=domreadyImgs[imgIndex];
if(currentImg.getAttribute(window.lzld.config.lazyAttr)&&inArray(currentImg,imgs)===-1)imgs.push(currentImg)}showImages();setTimeout(showImagesT,25)}function onLoad(){pageHasLoaded=true;showImagesT();setTimeout(showImagesT,25)}function throttle(fn,minDelay){var lastCall=0;return function(){var now=+new Date;if(now-lastCall<minDelay)return;lastCall=now;fn.apply(this,arguments)}}function addEvent(el,type,fn){if(el.attachEvent)el.attachEvent&&el.attachEvent("on"+type,fn);else el.addEventListener(type,
fn,false)}function removeEvent(el,type,fn){if(el.detachEvent)el.detachEvent&&el.detachEvent("on"+type,fn);else el.removeEventListener(type,fn,false)}function domready(callback){var done=false,top=true;function init(e){if(e.type==="readystatechange"&&document.readyState!=="complete")return;removeEvent(e.type==="load"?window:document,e.type,init);if(!done){done=true;callback()}}function poll(){try{document.documentElement.doScroll("left")}catch(e){setTimeout(poll,50);return}init("poll")}if(document.readyState===
"complete")callback();else{if(document.createEventObject&&document.documentElement.doScroll){try{top=!window.frameElement}catch(e){}if(top)poll()}addEvent(document,"DOMContentLoaded",init);addEvent(document,"readystatechange",init);addEvent(window,"load",init)}}function showIfVisible(img,index){if(contains(document.documentElement,img)&&img.getBoundingClientRect().top<winH+window.lzld.config.offset){img.onload=null;img.removeAttribute("onload");img.onerror=null;img.removeAttribute("onerror");var attr=
img.getAttribute(window.lzld.config.lazyAttr)?window.lzld.config.lazyAttr:"src",src=img.getAttribute(attr);if(window.lzld.config.retina===true||window.lzld.config.retina==="auto"&&isRetinaDevice())if(!img.getAttribute(dataHDAttr)){img.setAttribute(dataNoHDAttr,src);if(typeof window.lzld.config.hdCallback==="function")src=window.lzld.config.hdCallback(img.getAttribute(attr));img.setAttribute(dataHDAttr,src)}else src=img.getAttribute(dataHDAttr);else if(!img.getAttribute(dataNoHDAttr)){var noHDSrc=
img.getAttribute(dataNoHDAttr);if(noHDSrc)src=noHDSrc}else src=img.getAttribute(dataNoHDAttr);img.setAttribute(window.lzld.config.lazyAttr,src);img.src=img.getAttribute(window.lzld.config.lazyAttr);img.removeAttribute(window.lzld.config.lazyAttr);imgs[index]=null;return true}else return false}function defaultHdCallback(src){var srcSegments=src.split("."),srcWithoutExtension=srcSegments.slice(0,srcSegments.length-1).join("."),extension=srcSegments[srcSegments.length-1];return srcWithoutExtension+"@2x."+
extension}function viewport(){if(document.documentElement.clientHeight>=0)return document.documentElement.clientHeight;else if(document.body&&document.body.clientHeight>=0)return document.body.clientHeight;else if(window.innerHeight>=0)return window.innerHeight;else return 0}function saveViewport(){winH=viewport()}function showImages(){var last=imgs.length,current,allImagesDone=true;for(current=0;current<last;current++){var img=imgs[current];if(img!==null&&!showIfVisible(img,current))allImagesDone=
false}if(allImagesDone&&pageHasLoaded)unsubscribe()}function unsubscribe(){unsubscribed=true;removeEvent(window,"resize",saveViewportT);removeEvent(window,"scroll",showImagesT);removeEvent(window,"load",onLoad)}function subscribe(){unsubscribed=false;addEvent(window,"resize",saveViewportT);addEvent(window,"scroll",showImagesT)}function contains(){}contains=document.documentElement.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:document.documentElement.contains?function(a,
b){return a!==b&&(a.contains?a.contains(b):false)}:function(a,b){while(b=b.parentNode)if(b===a)return true;return false};function inArray(elem,array,i){var len;if(array){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(array,elem,i);len=array.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++)if(i in array&&array[i]===elem)return i}return-1}function update(){showImages()}})(this,document);return window.lzld});

/* -- end module lmd/ui/image/lazy-retina -- */
/* -- start module lmd/ui/component -- */
define("lmd/ui/component",function(require){var hogan=require("lib/hogan/core/hogan"),$=require("lib/jquery"),conf=require("lmd/core/conf"),eventsExpr=/([\w\_\-\.]*) *([\w\_\-\.\ ]*) */,quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/;var defaultProperties={template:null,el:null,$el:null,$:null,events:{},tagName:"<div>",className:"",options:{},data:{},compiledTemplate:null};var component=function(options){var descriptor;if(this.el===null&&this.$el===null&&this.template===null)throw"Empty template ["+
this.template+"]";this.options=options;this.el=this.el||(this.$el?this.$el[0]:null)||$(this.tagName)[0];this.$el=$(this.el).addClass(this.className);this.$=$.proxy(function(){var args=Array.prototype.slice.call(arguments);args.push(this.el);return $.apply(this,args)},this);for(descriptor in this.events)if(this.events.hasOwnProperty(descriptor)){var func=this.events[descriptor],m=descriptor.match(eventsExpr),event=m[1],selector=m[2],target=selector?$(selector,this.$el):this.$el;target.on(event,$.proxy(this[func],
this))}if(this.template===null)return;var isHtml=false;if(typeof this.template==="string"){var t=quickExpr.exec(this.template);if(t&&t[1])isHtml=true}if(!isHtml)this.template=$(this.template).html();this.render(this.data)};component.prototype.render=function(data){var descriptor;if(this.template===null||this.template.length===0)return;if(this.compiledTemplate===null)this.compiledTemplate=hogan.compile(this.template);var html=this.compiledTemplate.render(data);this.$el.html(html);for(descriptor in this.events)if(this.events.hasOwnProperty(descriptor)){var func=
this.events[descriptor],m=descriptor.match(eventsExpr),event=m[1],selector=m[2],target=selector?$(selector,this.$el):this.$el;if(target!==this.$el)target.on(event,$.proxy(this[func],this))}};component.prototype.on=function(event,callback,context){var f=context?$.proxy(callback,context):callback;this.$el.on(event,f);return this};component.prototype.trigger=function(event,extraParameters){this.$el.trigger(event,extraParameters);return this};component.prototype.attach=function(content){if(!content)throw"Missing content in component.attach(content)";
$(content).append(this.el);return this};component.prototype.detach=function(){this.$el.remove();return this};component.extend=function(o){if(typeof o==="undefined")throw"Missing object to component.extend({})";var subcomponent=function(options){var specialOptions={},i,k;for(k in options)if(options.hasOwnProperty(k))if(typeof defaultProperties[k]!=="undefined")specialOptions[k]=options[k];$.extend(this,defaultProperties,o,specialOptions);if(this.el===null&&this.$el===null&&this.template===null)throw'Missing template o={template:"..."} to component.extend(o)';
component.call(this,options);if(typeof this.initialize!=="undefined")this.initialize.apply(this,arguments)};subcomponent.prototype=$.extend({},component.prototype);return subcomponent};return component});

/* -- end module lmd/ui/component -- */
/* -- start module lmd/ui/lightbox -- */
define("lmd/ui/lightbox",["lib/jquery"],function($){var backBackgroundClass="filtre_page",lightboxClass="lightbox_ext";return{open:function(box,config){this.setBlackBg();var $box=$(box),$container=$("<div></div>").addClass(lightboxClass).append($box),k=this,width=$container.outerWidth(),height=$container.outerHeight();if(typeof config==="object"&&typeof config.width!=="undefined")width=config.width;if(typeof config==="object"&&typeof config.height!=="undefined")height=config.height;$container.css({position:"absolute",
top:Math.max(0,($(window).height()-height)/2+$(window).scrollTop())+"px",left:Math.max(0,($(window).width()-width)/2+$(window).scrollLeft())+"px"}).fadeIn(450);$(document).on("keyup",function(event){if(event.keyCode==27)k.close()});$container.find(".close-lightbox").on("click",$.proxy(this.close,this));$(document.body).append($container)},close:function(){$("."+lightboxClass).remove();this.setBlackBg(false)},setBlackBg:function(show){if(typeof show==="undefined")show=true;var $blackBg=$("."+backBackgroundClass);
if($blackBg.length===0){$blackBg=$("<div></div>").addClass(backBackgroundClass).hide();$(document.body).append($blackBg)}if(show)$blackBg.show();else $blackBg.hide()}}});

/* -- end module lmd/ui/lightbox -- */
/* -- start module lmd/module/user/meteo -- */
define("lmd/module/user/meteo",["lib/jquery","lmd/core/conf","lmd/core/storage","lmd/core/auth"],function($,conf,storage,auth){var meteo={TTL:36E5,STORAGE_KEY:"user_meteo",data:null,_loadDeferred:null,load:function(refresh){var firstLoad=false;if(this._loadDeferred===null)firstLoad=true;if(firstLoad||refresh){this._loadDeferred=$.Deferred();auth.loadUser().done($.proxy(function(){this._loadData(refresh)},this))}return this._loadDeferred.promise()},clearCache:function(){if(storage.get(this.STORAGE_KEY))storage.remove(this.STORAGE_KEY)},
_loadData:function(refresh){var dataStorage=null;if(storage.isSupported&&!refresh){dataStorage=storage.get(this.STORAGE_KEY);if(dataStorage!==null&&dataStorage.user_id===auth.user.id){this.data=dataStorage;return this._loadDeferred.resolve(this.data)}}var url="http://"+conf.current.location.hostname+"/api/1/user/meteo/",data={params:'{"mode": "info"}'};$.get(url,data,null,"jsonp").done($.proxy(this._loadDataCallback,this))},_loadDataCallback:function(data){if(typeof data==="object"&&typeof data.meteo!==
"undefined"){var storageData;this.data=data;if(storage.isSupported){storageData=this.data;storageData.user_id=auth.user.id;storage.set(this.STORAGE_KEY,storageData,this.TTL)}return this._loadDeferred.resolve(this.data)}return this._loadDeferred.reject()}};return meteo});

/* -- end module lmd/module/user/meteo -- */
/* -- start module lmd/module/retina -- */
define("lmd/module/retina",["lmd/ui/image/lazy-retina"],function(lazy_retina){var hdCallback=function(src){var pattern=new RegExp("("+lmd.conf.medias.location.hostname.replace(/s1/,"(s1|s2)")+")/image/(.*)"),srcParts=src.match(pattern);if(srcParts)src="http://"+srcParts[1]+"/image2x/"+srcParts[3];return src};lazy_retina.config.hdCallback=hdCallback;lazy_retina.config.offset=750;return lazy_retina});

/* -- end module lmd/module/retina -- */
/* -- start module lmd/module/alerte -- */
define("lmd/module/alerte",["lib/jquery","lmd/core/conf","lmd/core/storage","lmd/core/context","lmd/ui/component","lmd/core/social/facebook","lmd/core/live","template!/templates/module/general/alerte.html.mu"],function($,conf,storage,context,component,facebook,live,alerteTemplate){var Alerte=component.extend({template:alerteTemplate,current:null,events:{"click .croix_blanche":"hideAlerte","click .fb13x13_blanc":"onClickFacebook","click .tw13x13_blanc":"onClickTwitter","click .google13x13_blanc":"onClickGoogle","click .linkedin13x13_blanc":"onClickLinkedin"},
alertes:{history:{}},initialize:function(){this.hideConteneur();var closure=this;$.getJSON("/ws/1/ticker/alerte/").done(function(data){if(data&&typeof data.alertes!=="undefined")data.alertes.forEach(function(alerte){closure.showAlerte(alerte)})});this.initLiveListener()},initLiveListener:function(){live.on("alerte",$.proxy(function(event,data){this.showAlerte(data)},this));if(live.status==="stopped")live.start()},showAlerte:function(alerte){if(typeof this.alertes.history[alerte.alerte_id]!=="undefined")return;
if(storage.get("inhiber_alerte_"+alerte.alerte_id))return;if(context&&context.rubrique&&context.rubrique.id&&context.rubrique.id!=="3242"&&alerte.thematique==="alerte_thematisee_sport"&&alerte.niveau_envoi<3)return;this.current=alerte;this.alertes.history[alerte.alerte_id]=true;var texte_alerte='<strong class=" txt14_140">'+alerte.titre+"</strong>";texte_alerte+=alerte.texte;this.$(".heure_alerte").html(alerte.heure_minute);this.$(".texte_alerte").html(texte_alerte);this.showConteneur()},hideAlerte:function(){if(this.current===
null)return;storage.set("inhiber_alerte_"+this.current.alerte_id,"true",36E5);this.hideConteneur();this.current=null},showConteneur:function(){this.$el.removeClass("invisible").addClass("visible");this.$el.show()},hideConteneur:function(){this.$el.hide();this.$el.removeClass("visible").addClass("invisible")},onClickFacebook:function(){if(this.current===null||typeof this.current.titre==="undefined")return;var link="http://"+conf.www.location.hostname;facebook.load().done($.proxy(function(){window.FB.ui({method:"feed",
link:link,caption:this.current.titre,description:this.current.texte,redirect_uri:"http://www.lemonde.fr"})},this))},onClickTwitter:function(){if(this.current===null||typeof this.current.titre==="undefined")return;var link="http://"+conf.www.location.hostname+"#xtor=AL-32280258";var titre=this._htmlEntities(this.current.titre);var url="http://twitter.com/share?related=lemondefr&via=lemondefr&lang=fr&text="+titre+"&url="+link;var params={};params.width=550;params.height=280;this._openPopupShare(url,
params)},onClickGoogle:function(){if(this.current===null||typeof this.current.titre==="undefined")return;var link="http://"+conf.www.location.hostname+"#xtor=AL-32280258";var titre=this._htmlEntities(this.current.titre);var url="https://plusone.google.com/_/+1/confirm?hl=en&url="+link;var params={};params.width=440;params.height=340;this._openPopupShare(url,params)},onClickLinkedin:function(){if(this.current===null||typeof this.current.titre==="undefined")return;var link="http://"+conf.www.location.hostname;
var titre=this._htmlEntities(this.current.titre);var url="http://www.linkedin.com/shareArticle?mini=true&url="+link+"&title="+titre+"&source=LeMonde.fr";var params={};params.width=550;params.height=340;this._openPopupShare(url,params)},_openPopupShare:function(url,params){var w="width",h="height";var width=typeof params.width!=="undefined"?params.width:650;var height=typeof params.height!=="undefined"?params.height:430;var left=($(window)[w]()-width)/2;var top=($(window)[h]()-height)/2;params="width="+
String(width)+",height="+String(height)+",top="+String(top)+",left="+String(left);params+=",location=no,resizable=yes,status=no,titlebar=no,toolbar=no";window.open(encodeURI(url),"alerte_share_popup",params)},_htmlEntities:function(texte){return texte}});return Alerte});

/* -- end module lmd/module/alerte -- */
/* -- start module lmd/module/encontinu -- */
define("lmd/module/encontinu",["lmd/ui/component","lib/jquery","lmd/core/context","template!/templates/module/general/en_continu.html.mu"],function(component,$,context,tplEnContinu){var rubriqueUne=context&&context.pageType===context.PAGE_TYPE_UNE,template=rubriqueUne?null:tplEnContinu;var encontinu=component.extend({template:template,speed:10,i:1,initialize:function(options){if(rubriqueUne)this.animate();else this.fetch().done($.proxy(function(){this.animate()},this))},fetch:function(){var $el=this.$el,dfd=new $.Deferred;
dfd.promise(this);$.getJSON("/ws/1/ticker/en_continu/").done($.proxy(function(data){if(data&&typeof data.elements!=="undefined"){var elements=data.elements.map(function(element,i){element.premier=i===0;return element},this);this.render({service_en_continu:elements})}dfd.resolve()},this));return this},animate:function(){var intervalId=null;return function(speed){if(intervalId!==null)window.clearInterval(intervalId);if(speed===0)return;speed=speed||this.speed;intervalId=window.setInterval($.proxy(this.cycle,
this),speed*1E3);return this}}(),cycle:function(){var elements=this.$(".titre");var i=this.i;elements.each(function(j){if(i%elements.length===j)$(this).show();else $(this).hide()});this.i++;return this}});return encontinu});

/* -- end module lmd/module/encontinu -- */
/* -- start module lmd/module/lives -- */
define("lmd/module/lives",["lmd/ui/component","lib/jquery","lmd/core/context","lmd/core/storage","lmd/module/live","lmd/core/live","template!/templates/module/general/lives.html.mu"],function(component,$,context,storage,ModuleLive,live,livesTemplate){var defaultIframeWidth=328,defaultIframeHeight=550,minPossibleIframeHeight=400,minTopScreenBlankSpace=150,liveBannerHeight=26,chromeHeight=25;var computeIframeWidthHeight=function(){var windowHeight=$(window).height();var iframeWidth=defaultIframeWidth;var maxIframeHeight=
windowHeight-minTopScreenBlankSpace;var iframeHeight=Math.min(maxIframeHeight,defaultIframeHeight);return{width:iframeWidth,height:iframeHeight,minHeight:minPossibleIframeHeight}};var iframeSize=computeIframeWidthHeight();var marginTop=0;if($(".global").length)marginTop=$(".global").position().top;var Lives=component.extend({template:livesTemplate,className:"lives",events:{"click a.popup":"clickPopup","click .chrome":"clickDeplierReplier","click .live_fermer":"clickFermer"},lives:[],comments:{queue:[],
history:{},interval:5E3},ouvrable_par_defaut:false,popuped:false,cil_ouvrable:parseInt(iframeSize.height,10)>=parseInt(iframeSize.minHeight,10),status:null,liveId:null,savedStatus:null,savedLiveId:null,autoloadFromService:true,initialize:function(options){$.extend(this,options);if(storage.isSupported){this.savedStatus=storage.get("ticker.live.status");this.savedLiveId=storage.get("ticker.live.liveId")}if(this.popuped===false)$(window).scroll($.proxy(this.tryAutoExpand,this));else{$.extend(iframeSize,
{width:parseInt(defaultIframeWidth,10),height:parseInt(defaultIframeHeight,10)});this.$(".chrome a").hide()}if(this.autoloadFromService)this.createLivesFromService().done($.proxy(function(){this.initLiveListener()},this))},initLiveListener:function(){var t=this,firstPooling=true;live.on("cil.comment",function(event,data){t.enqueue(data)});live.on("success.end",function(){if(firstPooling){t.dequeueLatest();t.dequeueAll();firstPooling=false}});live.start()},updateStatus:function(newStatus,liveId,save){this.$el.removeClass("desactive moyen grand popuped");
this.$el.addClass(newStatus);this.status=newStatus;this.liveId=liveId;if(save){if(storage.isSupported){var timeout=1E3*3600*24;var session=false;storage.set("ticker.live.status",newStatus,timeout,session);storage.set("ticker.live.liveId",liveId,timeout,session)}this.savedStatus=newStatus;this.savedLiveId=liveId}},getLiveById:function(id){var i;for(i=0;i<this.lives.length;++i)if(parseInt(this.lives[i].liveInfos.id,10)===parseInt(id,10))return this.lives[i];return null},getLiveByStatus:function(status){var i;
for(i=0;i<this.lives.length;++i)if(this.lives[i].status===status)return this.lives[i];return null},getLiveByAltcastCode:function(altcastCode){var i;for(i=0;i<this.lives.length;++i)if(this.lives[i].liveInfos.altcast_code===altcastCode)return this.lives[i];return null},tryAutoExpand:function(){if(this.lives.length===0)return;if(this.savedStatus!==null)return;if(!this.cil_ouvrable)return;var w="width",h="height",ww=parseInt($(window)[w](),10),wh=parseInt($(window)[h](),10),wst=parseInt($(window).scrollTop(),
10),liveHeight=parseInt(iframeSize.height,10)+this.lives.length*liveBannerHeight,live;if(ww>1640||wh+wst-liveHeight>marginTop&&this.ouvrable_par_defaut){live=this.getLiveByStatus("moyen");if(live)this.deplier(live)}else{live=this.getLiveByStatus("grand");if(live)this.replier(live)}},createLivesFromService:function(){var t=this;return $.getJSON("/ws/1/ticker/live/").done(function(data){var rubriqueUne=context&&context.pageType===context.PAGE_TYPE_UNE;var revolutionnaire=context&&context.rubrique&&
typeof context.rubrique.maquette==="string"&&context.rubrique.maquette.indexOf("revolutionnaire")!==-1;t.ouvrable_par_defaut=rubriqueUne&&(data.ouvert_par_defaut||revolutionnaire);t.createLives(data.lives)})},createLives:function(lives){lives.forEach(function(live){var moduleLive=new ModuleLive({liveInfos:live,iframeSize:iframeSize,status:"desactive",popuped:this.popuped});this.push(moduleLive)},this);var popupedLive=null;if(this.popuped){if(typeof this.options.popupedLiveId!=="undefined")popupedLive=
this.getLiveById(this.options.popupedLiveId);if(popupedLive===null)popupedLive=this.lives[0];this.deplier(popupedLive)}},push:function(moduleLive){var closure=this;moduleLive.on("deplier",function(){closure.updateStatus("grand",moduleLive.liveInfos.id,true);closure.deplier(moduleLive)});moduleLive.on("participez",function(e){closure.clickDeplierReplier(e)});this.lives.push(moduleLive);this.$el.append(moduleLive.$el)},clickDeplierReplier:function(e){e.preventDefault();e.stopPropagation();if(this.popuped||
!this.cil_ouvrable)return;var live=this.getLiveByStatus("moyen")||this.getLiveByStatus("grand");if(live===null)live=this.getLiveById(this.savedLiveId);if(live===null)live=this.lives[0];if(live.status==="moyen"){this.updateStatus("grand",live.liveInfos.id,true);this.deplier(live)}else{this.updateStatus("moyen",live.liveInfos.id,true);this.replier(live)}},clickFermer:function(e){e.preventDefault();e.stopPropagation();var live=this.getLiveByStatus("moyen")||this.getLiveByStatus("grand");this.updateStatus("desactive",
live.liveInfos.id,true);this.fermer(live)},clickPopup:function(e){e.preventDefault();e.stopPropagation();var live=this.getLiveByStatus("moyen")||this.getLiveByStatus("grand");if(live===null)live=this.getLiveById(this.savedLiveId);if(live===null)live=this.lives[0];this.updateStatus(live.status,live.liveInfos.id,true);this.popup(live)},deplier:function(live){this.lives.forEach(function(lp){if(live!==lp)lp.petit()});this.$(".chrome .titre").empty();this.$(".chrome").show();this.$(".live_deplier").hide();
if(this.popuped===false)this.$(".live_replier").show();live.grand();this.updateStatus("grand",live.liveInfos.id)},replier:function(live,doNotDequeue){this.lives.forEach(function(lp){lp.desactiver()});if(doNotDequeue!==true){this.dequeueLatest();this.dequeueAll()}this.$(".chrome .titre").html(live.liveInfos.titre);this.$(".chrome").show();if(this.cil_ouvrable)this.$(".live_deplier").show();else this.$(".live_deplier").hide();this.$(".live_replier").hide();this.$(".live_fermer").show();live.moyen();
this.updateStatus("moyen",live.liveInfos.id)},fermer:function(live){this.lives.forEach(function(lp){lp.desactiver()});if(live!==null)this.$(".chrome .titre").html(live.liveInfos.titre);this.$(".chrome").show();this.$(".live_fermer").hide();this.$(".live_replier").hide();this.$(".live_deplier").show();this.updateStatus("desactive",live.liveInfos.id)},popup:function(live){var oldStatus=live.status;this.lives.forEach(function(lp){lp.desactiver()});this.$(".chrome").hide();live.desactiver();this.updateStatus("popuped",
live.liveInfos.id);var popupHeight=parseInt(defaultIframeHeight,10)+this.lives.length*liveBannerHeight+chromeHeight+5;var popupWidth=parseInt(iframeSize.width,10);var w=window.open("/popup/live/"+live.liveInfos.id+"/","Live","resizable=no,scrollbar=no,status=no,toolbar=no,"+"width="+String(popupWidth)+","+"height="+String(popupHeight));w.focus();var t=setInterval($.proxy(function(){if(w.closed){clearInterval(t);this.$(".chrome").show();this.dequeueAll();if(oldStatus==="moyen")this.replier(live);else if(oldStatus===
"grand")this.deplier(live);else live.desactiver()}},this),1E3)},enqueue:function(){var first=true;return function(comment){var d=comment.altcast_code+":"+comment.itemID;var isInQueue=this.comments.queue.some(function(c){return d===c.altcast_code+":"+c.itemID});var isInHistory=typeof this.comments.history[d]!=="undefined";if(!isInQueue&&!isInHistory)this.comments.queue.push(comment);if(first){setTimeout($.proxy(function(){this.dequeue(this.comments.interval)},this),10);first=false}}}(),dequeue:function(){var intervalId=
null;return function(interval){if(typeof interval==="undefined")throw"missing interval in dequeue(interval)";if(interval===0){if(intervalId!==null){window.clearInterval(intervalId);intervalId=null}return}this.dequeueFirst();intervalId=window.setInterval($.proxy(this.dequeueFirst,this),interval)}}(),dequeueFirst:function(){var queue=this.comments.queue;if(queue.length===0)return;this.displayComment(queue.shift())},dequeueAll:function(){var queue=this.comments.queue;while(queue.length>0)this.dequeueFirst()},
dequeueLatest:function(){var queue=this.comments.queue;var latestComment=null;if(queue.length===0)return;queue.forEach(function(comment){if(latestComment===null||parseInt(latestComment.timestamp,10)<parseInt(comment.timestamp,10))latestComment=comment});this.comments.queue=queue.filter(function(comment){return comment!==latestComment});this.displayComment(latestComment)},displayComment:function(){var first=true;return function(comment){var history=this.comments.history,descriptor=comment.altcast_code+
":"+comment.itemID;if(typeof history[descriptor]!=="undefined")return;history[descriptor]=true;var live=this.getLiveByAltcastCode(comment.altcast_code);if(!live)return;live.updateComment(comment);if(this.status==="grand"||this.status==="popuped"||this.status==="desactive")return;var lpMoyen=this.getLiveByStatus("moyen");if(lpMoyen!==null)if(parseInt(live.lastComment.timestamp,10)<parseInt(lpMoyen.lastComment.timestamp,10))return;if(first){first=false;if(this.savedStatus==="desactive")this.fermer(live);
else if(this.savedStatus==="moyen")this.replier(live,true);else if(this.savedStatus==="grand"&&this.cil_ouvrable)if(this.getLiveById(this.savedLiveId))this.deplier(this.getLiveById(this.savedLiveId));else this.deplier(live);else{this.replier(live,true);this.tryAutoExpand()}return}if(lpMoyen===null)this.replier(live,true);else $.when(lpMoyen.desactiver()).then($.proxy(function(){this.replier(live,true)},this))}}()});return Lives});

/* -- end module lmd/module/lives -- */
/* -- start module lmd/module/live -- */
define("lmd/module/live",["lib/jquery","lmd/ui/component","template!/templates/module/general/live.html.mu"],function($,component,t){var Live=component.extend({template:t,className:"live",events:{"click .bandeau":"onClickBandeau","click .voir":"onClickVoir","click .btn":"onClickParticipez"},status:"moyen",liveInfos:{id:"",altcast_code:"",embed:"",link:"",titre:""},lastComment:{itemID:"",timestamp:0,author_name:"",comment:"",time:"",altcast_code:""},iframeSize:{width:328,height:550},iframeLoaded:false,initialize:function(options){$.extend(this,
options);this.liveInfos.embed='<iframe src="http://www.coveritlive.com/index2.php/option=com_altcaster/task=viewaltcast/altcast_code='+this.liveInfos.altcast_code+"/height="+String(this.iframeSize.height)+"/width="+String(this.iframeSize.width)+'" scrolling="no" height="'+String(this.iframeSize.height)+'px" width="'+String(this.iframeSize.width)+'px" frameBorder="0" allowTransparency="true" style="position:relative;" ></iframe>';this.$(".titre").html(this.liveInfos.titre);this.$(".voir").attr("href",
this.liveInfos.link);this.$("a.popup").attr("href","/popup/live/"+this.liveInfos.id+"/"+String(this.iframeSize.width)+"/"+String(this.iframeSize.height)+"/");if(this.status==="desactive")this.$el.hide()},repaint:function(){if(this.status==="desactive"){this.$el.removeClass("petit moyen grand");return}if(this.status==="grand"){if(this.iframeLoaded===false){this.$(".cil").html(this.liveInfos.embed);this.iframeLoaded=true}}else if(this.status==="moyen"){this.$(".toast .heure").html(this.lastComment.time);
this.$(".toast .details").html(this.lastComment.comment)}this.$el.removeClass("petit moyen grand");this.$el.addClass(this.status)},updateComment:function(comment){this.lastComment=comment;this.repaint()},onClickBandeau:function(e){if(this.status==="moyen"||this.status==="petit")this.trigger("deplier")},onClickVoir:function(e){if(this.options.popuped){e.preventDefault();e.stopPropagation();if(window.opener){window.opener.location=this.liveInfos.link;window.close()}else window.open(this.liveInfos.link)}},
onClickParticipez:function(e){e.preventDefault();e.stopPropagation();this.trigger("participez")},grand:function(){if(this.status==="grand")return;this.$el.show();this.status="grand";this.$(".titre").html('<a href="'+this.liveInfos.link+'">'+this.liveInfos.titre+"</a>");this.$(".voir").attr("href",this.liveInfos.link);this.asyncRepaint();return this},moyen:function(){if(this.status==="moyen")return;this.$el.hide();this.status="moyen";this.asyncRepaint(this.$el.fadeIn());return this},petit:function(){if(this.status===
"petit")return;this.$el.hide();this.status="petit";this.$(".titre").html(this.liveInfos.titre);this.asyncRepaint(this.$el.fadeIn());return this},desactiver:function(){if(this.status==="desactive")return;this.status="desactive";this.$el.hide();this.asyncRepaint();return this},asyncRepaint:function(pos,pre){pre=pre||[];pos=pos||[];pre=$.isArray(pre)?pre:[pre];pos=$.isArray(pos)?pre:[pos];var dfd=new $.Deferred;dfd.promise(this);$.when.apply(null,pre).then($.proxy(function(){this.repaint();$.when.apply(null,
pos).then($.proxy(function(){dfd.resolve()},this))},this))}});return Live});

/* -- end module lmd/module/live -- */
/* -- start module lmd/module/partenaire/monster_form -- */
/**
 * Actions a attacher a la soumission d'un formulaire :
 * - verification que les donnees sont soumises en utf-8
 * - comptage xiti (xt_click ne fonctionne qu'avec des balises anchor)
 * @param <string> formname la nom du formulaire (i.e. valeur de sa balise name)
 * @param <string> xiti le tag de comptage xiti
 */
define("lmd/module/partenaire/monster_form",function () {
      "use strict";

      return function (formName, xiti) {
         document[formName].onsubmit = function (event) {
            event.preventDefault();
            var get = '?{{qs}}',
                inputs = event.target.getElementsByTagName("input"), len = inputs.length, i = 0;
            for (i; i < len; i = i + 1) {
               get = get + "&" + unescape( encodeURIComponent( inputs[i].name + "=" + inputs[i].value ) ).replace(/[\?&]/g, ' ');
            }

            xt_med('C', '35', xiti, 'N');
            window.open(event.target.action + get);
         };
      };
   }
);
/* -- end module lmd/module/partenaire/monster_form -- */